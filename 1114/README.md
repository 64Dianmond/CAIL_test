# 法律量刑预测系统

本系统基于大型语言模型和专业的刑期计算工具，用于预测刑事案件的量刑结果。

## 文件说明

### predict_fact_function_call_1114.py
这是主程序文件，包含量刑预测的核心逻辑：
- 使用OpenAI API进行量刑情节提取和刑期预测
- 采用"提取-注入-计算"的三步混合法
- 支持工具调用，使用专业计算器进行精确的刑期计算
- 包含两个主要任务：
  1. Task 1: 从案件信息中提取量刑情节
  2. Task 2: 基于提取的情节和专业计算器计算刑期区间
- 使用cal.py作为刑期计算工具模块

### pre.py
这是另一个主程序文件，与predict_fact_function_call_1114.py功能类似，但使用cal1.py作为刑期计算工具模块。

### cal.py
这是刑期计算工具文件，提供精确的量刑计算功能：
- 基准刑计算：根据罪名和犯罪事实（金额/伤害等级）计算基准刑
- 分层量刑计算：支持复杂的量刑情节调节计算
- 法定约束条件：确保计算结果符合法律规定的上下限
- 工具函数：提供OpenAI Function Calling格式的接口
- 包含故意伤害罪的完整伤害等级分类
- 区间宽度为4并且计算更为保守

### cal1.py
这是另一个刑期计算工具文件，与cal.py功能类似但有以下区别：
- 移除了故意伤害罪中不包含具体等级的伤害描述（如"轻微伤"、"轻伤"、"重伤"）
- 只保留包含具体等级的伤害描述（如"轻伤一级"、"轻伤二级"等）
- 在calculate_base_sentence方法中对盗窃罪和诈骗罪的计算参数进行了调整
- 区间宽度为6并且计算相比cal的刑期会略大

## 功能特点

1. **专业量刑计算**：避免LLM直接进行数值计算，使用专业计算器确保准确性
2. **分层量刑模型**：支持第一层面（连乘）和第二层面（加减）的情节调节
3. **法定约束保障**：确保计算结果符合法定刑档位范围和减轻幅度限制
4. **灵活配置**：支持多种罪名（盗窃罪、诈骗罪、故意伤害罪）和伤害等级
5. **区间输出**：生成合理的刑期区间，宽度固定为6个月
6. **双版本计算工具**：提供cal.py和cal1.py两个版本的计算工具，满足不同需求

## 罪名支持

- 盗窃罪
- 诈骗罪
- 故意伤害罪（支持具体伤害等级）

## 伤害等级（故意伤害罪）

### cal.py版本
- 轻伤一级
- 轻伤二级
- 重伤一级
- 重伤二级
- 致人死亡
- 死亡

### cal1.py版本
- 轻伤一级
- 轻伤二级
- 重伤一级
- 重伤二级
- 致人死亡
- 死亡

## 量刑约束条件

1. 总减轻幅度原则上不得超过基准刑的50%（除非有法定减轻情节）
2. 无法定减轻情节时，刑期不能低于对应档位的最低刑期
3. 有法定减轻情节时，最低刑期可以降至1个月
4. 刑期不能超过对应档位的最高刑期

## 使用方法

1. 配置环境变量（API密钥等）
2. 准备案件数据文件
3. 运行主程序：`python pre.py`
4. 系统将自动处理数据并生成预测结果文件

## 成绩说明
predict_fact_function_call_1114.py：Final_score: 0.482516, Task1_avg_F1: 0.5609, Task2_avg_Winkler: 0.4042
pre.py：Final_score: 0.48635, Task1_avg_F1: 0.5651, Task2_avg_Winkler: 0.4076